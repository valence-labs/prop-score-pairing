[INFO] fit_SCGLUE: Pretraining SCGLUE model...
[INFO] autodevice: Using GPU 0 as computation device.
[INFO] check_graph: Checking variable coverage...
[INFO] check_graph: Checking edge attributes...
[INFO] check_graph: Checking self-loops...
[INFO] check_graph: Checking graph symmetry...
[INFO] check_graph: All checks passed!
[INFO] SCGLUEModel: Setting `graph_batch_size` = 4868
[INFO] SCGLUEModel: Setting `max_epochs` = 48
[INFO] SCGLUEModel: Setting `patience` = 4
[INFO] SCGLUEModel: Setting `reduce_lr_patience` = 2
[INFO] SCGLUETrainer: Using training directory: "/tmp/GLUETMPq1yp846i"
[INFO] SCGLUETrainer: [Epoch 10] train={'g_nll': 0.022, 'g_kl': 0.02, 'g_elbo': 0.041, 'x_rna_nll': 0.31, 'x_rna_kl': 0.002, 'x_rna_elbo': 0.312, 'x_adt_nll': 0.915, 'x_adt_kl': 0.094, 'x_adt_elbo': 1.008, 'dsc_loss': 0.665, 'vae_loss': 1.322, 'gen_loss': 1.288}, val={'g_nll': 0.024, 'g_kl': 0.02, 'g_elbo': 0.043, 'x_rna_nll': 0.311, 'x_rna_kl': 0.002, 'x_rna_elbo': 0.313, 'x_adt_nll': 0.899, 'x_adt_kl': 0.091, 'x_adt_elbo': 0.99, 'dsc_loss': 0.663, 'vae_loss': 1.305, 'gen_loss': 1.272}, 32.3s elapsed
Epoch 00014: reducing learning rate of group 0 to 2.0000e-04.
Epoch 00014: reducing learning rate of group 0 to 2.0000e-04.
[INFO] LRScheduler: Learning rate reduction: step 1
Epoch 00018: reducing learning rate of group 0 to 2.0000e-05.
Epoch 00018: reducing learning rate of group 0 to 2.0000e-05.
[INFO] LRScheduler: Learning rate reduction: step 2
2023-10-24 07:59:02,305 ignite.handlers.early_stopping.EarlyStopping INFO: EarlyStopping: Stop training
[INFO] EarlyStopping: Restoring checkpoint "19"...
[INFO] EarlyStopping: Restoring checkpoint "19"...
[INFO] fit_SCGLUE: Estimating balancing weight...
[INFO] estimate_balancing_weight: Clustering cells...
[INFO] estimate_balancing_weight: Matching clusters...
[INFO] estimate_balancing_weight: Matching array shape = (25, 26)...
[INFO] estimate_balancing_weight: Estimating balancing weight...
[INFO] fit_SCGLUE: Fine-tuning SCGLUE model...
[INFO] check_graph: Checking variable coverage...
[INFO] check_graph: Checking edge attributes...
[INFO] check_graph: Checking self-loops...
[INFO] check_graph: Checking graph symmetry...
[INFO] check_graph: All checks passed!
[INFO] SCGLUEModel: Setting `graph_batch_size` = 4868
[INFO] SCGLUEModel: Setting `align_burnin` = 8
[INFO] SCGLUEModel: Setting `max_epochs` = 48
[INFO] SCGLUEModel: Setting `patience` = 4
[INFO] SCGLUEModel: Setting `reduce_lr_patience` = 2
[INFO] SCGLUETrainer: Using training directory: "/tmp/GLUETMPmxscz5ba"
[INFO] SCGLUETrainer: [Epoch 10] train={'g_nll': 0.024, 'g_kl': 0.017, 'g_elbo': 0.041, 'x_rna_nll': 0.312, 'x_rna_kl': 0.002, 'x_rna_elbo': 0.314, 'x_adt_nll': 0.913, 'x_adt_kl': 0.093, 'x_adt_elbo': 1.006, 'dsc_loss': 0.634, 'vae_loss': 1.322, 'gen_loss': 1.29}, val={'g_nll': 0.023, 'g_kl': 0.017, 'g_elbo': 0.041, 'x_rna_nll': 0.311, 'x_rna_kl': 0.002, 'x_rna_elbo': 0.313, 'x_adt_nll': 0.9, 'x_adt_kl': 0.093, 'x_adt_elbo': 0.992, 'dsc_loss': 0.658, 'vae_loss': 1.307, 'gen_loss': 1.274}, 30.3s elapsed
Epoch 00017: reducing learning rate of group 0 to 2.0000e-04.
Epoch 00017: reducing learning rate of group 0 to 2.0000e-04.
[INFO] LRScheduler: Learning rate reduction: step 1
[INFO] SCGLUETrainer: [Epoch 20] train={'g_nll': 0.023, 'g_kl': 0.017, 'g_elbo': 0.04, 'x_rna_nll': 0.311, 'x_rna_kl': 0.002, 'x_rna_elbo': 0.312, 'x_adt_nll': 0.907, 'x_adt_kl': 0.094, 'x_adt_elbo': 1.0, 'dsc_loss': 0.668, 'vae_loss': 1.315, 'gen_loss': 1.281}, val={'g_nll': 0.023, 'g_kl': 0.017, 'g_elbo': 0.04, 'x_rna_nll': 0.311, 'x_rna_kl': 0.002, 'x_rna_elbo': 0.313, 'x_adt_nll': 0.893, 'x_adt_kl': 0.094, 'x_adt_elbo': 0.987, 'dsc_loss': 0.648, 'vae_loss': 1.302, 'gen_loss': 1.27}, 42.7s elapsed
Epoch 00021: reducing learning rate of group 0 to 2.0000e-05.
Epoch 00021: reducing learning rate of group 0 to 2.0000e-05.
[INFO] LRScheduler: Learning rate reduction: step 2
Epoch 00025: reducing learning rate of group 0 to 2.0000e-06.
Epoch 00025: reducing learning rate of group 0 to 2.0000e-06.
[INFO] LRScheduler: Learning rate reduction: step 3
2023-10-24 08:21:00,643 ignite.handlers.early_stopping.EarlyStopping INFO: EarlyStopping: Stop training
[INFO] EarlyStopping: Restoring checkpoint "26"...
[INFO] EarlyStopping: Restoring checkpoint "26"...
Cell type: B1 B IGKC+, Number of samples: 820
Cell type: B1 B IGKC+, kNN trace: 1.0017605633802817
Cell type: B1 B IGKC+, EOT trace: 2.2331377886356965
Cell type: B1 B IGKC+, kNN FOSCTTM: 0.27268754280949403
Cell type: B1 B IGKC+, EOT FOSCTTM: 0.4174357485333095
Cell type: B1 B IGKC-, Number of samples: 613
Cell type: B1 B IGKC-, kNN trace: 2.0277777777777777
Cell type: B1 B IGKC-, EOT trace: 1.1567914593756328
Cell type: B1 B IGKC-, kNN FOSCTTM: 0.3852797236349678
Cell type: B1 B IGKC-, EOT FOSCTTM: 0.41867783002271053
Cell type: CD14+ Mono, Number of samples: 21693
Cell type: CD14+ Mono, kNN trace: 1.0
Cell type: CD14+ Mono, EOT trace: 3.1646241531514328
Cell type: CD14+ Mono, kNN FOSCTTM: 0.46379408142248607
Cell type: CD14+ Mono, EOT FOSCTTM: 0.45011465015652385
Cell type: CD16+ Mono, Number of samples: 2635
Cell type: CD16+ Mono, kNN trace: 0.00045808520384791576
Cell type: CD16+ Mono, EOT trace: 4.558668400616138
Cell type: CD16+ Mono, kNN FOSCTTM: 0.4114885766195669
Cell type: CD16+ Mono, EOT FOSCTTM: 0.35607268258174013
Cell type: CD4+ T CD314+ CD45RA+, Number of samples: 93
Cell type: CD4+ T CD314+ CD45RA+, kNN trace: 0.2357142857142857
Cell type: CD4+ T CD314+ CD45RA+, EOT trace: 1.4930576190409541
Cell type: CD4+ T CD314+ CD45RA+, kNN FOSCTTM: 0.42800374006545105
Cell type: CD4+ T CD314+ CD45RA+, EOT FOSCTTM: 0.41923796166432914
Cell type: CD4+ T activated, Number of samples: 6966
Cell type: CD4+ T activated, kNN trace: 2.761904761904762
Cell type: CD4+ T activated, EOT trace: 3.060301843903864
Cell type: CD4+ T activated, kNN FOSCTTM: 0.3960941246983863
Cell type: CD4+ T activated, EOT FOSCTTM: 0.4090366726376231
Cell type: CD4+ T activated integrinB7+, Number of samples: 1056
Cell type: CD4+ T activated integrinB7+, kNN trace: 1.0
Cell type: CD4+ T activated integrinB7+, EOT trace: 2.309458267101131
Cell type: CD4+ T activated integrinB7+, kNN FOSCTTM: 0.42470334266839005
Cell type: CD4+ T activated integrinB7+, EOT FOSCTTM: 0.4235921118770644
Cell type: CD4+ T naive, Number of samples: 5897
Cell type: CD4+ T naive, kNN trace: 3.581818181818182
Cell type: CD4+ T naive, EOT trace: 2.520080950144272
Cell type: CD4+ T naive, kNN FOSCTTM: 0.39097167303752867
Cell type: CD4+ T naive, EOT FOSCTTM: 0.3994546878814493
Cell type: CD8+ T CD49f+, Number of samples: 912
Cell type: CD8+ T CD49f+, kNN trace: 4.345543990892828
Cell type: CD8+ T CD49f+, EOT trace: 3.4823144362300713
Cell type: CD8+ T CD49f+, kNN FOSCTTM: 0.44979550619138403
Cell type: CD8+ T CD49f+, EOT FOSCTTM: 0.44990022050185835
Cell type: CD8+ T CD57+ CD45RA+, Number of samples: 1303
Cell type: CD8+ T CD57+ CD45RA+, kNN trace: 3.515873015873016
Cell type: CD8+ T CD57+ CD45RA+, EOT trace: 2.3846304359651675
Cell type: CD8+ T CD57+ CD45RA+, kNN FOSCTTM: 0.3896546784980424
Cell type: CD8+ T CD57+ CD45RA+, EOT FOSCTTM: 0.3746408795489082
Cell type: CD8+ T CD57+ CD45RO+, Number of samples: 1470
Cell type: CD8+ T CD57+ CD45RO+, kNN trace: 2.4
Cell type: CD8+ T CD57+ CD45RO+, EOT trace: 3.2270008990236416
Cell type: CD8+ T CD57+ CD45RO+, kNN FOSCTTM: 0.4201238289733864
Cell type: CD8+ T CD57+ CD45RO+, EOT FOSCTTM: 0.4170723292720764
Cell type: CD8+ T CD69+ CD45RA+, Number of samples: 740
Cell type: CD8+ T CD69+ CD45RA+, kNN trace: 0.0588949605343048
Cell type: CD8+ T CD69+ CD45RA+, EOT trace: 2.479681808239204
Cell type: CD8+ T CD69+ CD45RA+, kNN FOSCTTM: 0.4310262224335296
Cell type: CD8+ T CD69+ CD45RA+, EOT FOSCTTM: 0.4314166331419376
Cell type: CD8+ T CD69+ CD45RO+, Number of samples: 897
Cell type: CD8+ T CD69+ CD45RO+, kNN trace: 1.125
Cell type: CD8+ T CD69+ CD45RO+, EOT trace: 0.46433486672696
Cell type: CD8+ T CD69+ CD45RO+, kNN FOSCTTM: 0.4345928641105271
Cell type: CD8+ T CD69+ CD45RO+, EOT FOSCTTM: 0.43691770186335405
Cell type: CD8+ T TIGIT+ CD45RA+, Number of samples: 1032
Cell type: CD8+ T TIGIT+ CD45RA+, kNN trace: 1.0434782608695652
Cell type: CD8+ T TIGIT+ CD45RA+, EOT trace: 1.3485021134267503
Cell type: CD8+ T TIGIT+ CD45RA+, kNN FOSCTTM: 0.3947351107903067
Cell type: CD8+ T TIGIT+ CD45RA+, EOT FOSCTTM: 0.4126995315754254
Cell type: CD8+ T TIGIT+ CD45RO+, Number of samples: 1160
Cell type: CD8+ T TIGIT+ CD45RO+, kNN trace: 0.3333333333333333
Cell type: CD8+ T TIGIT+ CD45RO+, EOT trace: 1.0815646403255499
Cell type: CD8+ T TIGIT+ CD45RO+, kNN FOSCTTM: 0.4448216357740026
Cell type: CD8+ T TIGIT+ CD45RO+, EOT FOSCTTM: 0.46516653774062067
Cell type: CD8+ T naive, Number of samples: 3107
Cell type: CD8+ T naive, kNN trace: 1.21
Cell type: CD8+ T naive, EOT trace: 2.330224493957984
Cell type: CD8+ T naive, kNN FOSCTTM: 0.29089269582362987
Cell type: CD8+ T naive, EOT FOSCTTM: 0.3827286639167814
Cell type: CD8+ T naive CD127+ CD26- CD101-, Number of samples: 42
Cell type: CD8+ T naive CD127+ CD26- CD101-, kNN trace: 1.024390243902439
Cell type: CD8+ T naive CD127+ CD26- CD101-, EOT trace: 2.2885554868110836
Cell type: CD8+ T naive CD127+ CD26- CD101-, kNN FOSCTTM: 0.37891986062717775
Cell type: CD8+ T naive CD127+ CD26- CD101-, EOT FOSCTTM: 0.3495934959349593
Cell type: Erythroblast, Number of samples: 4039
Cell type: Erythroblast, kNN trace: 1.5072401817817391
Cell type: Erythroblast, EOT trace: 1.4826952008604517
Cell type: Erythroblast, kNN FOSCTTM: 0.4034672284502966
Cell type: Erythroblast, EOT FOSCTTM: 0.43499269320754635
Cell type: G/M prog, Number of samples: 1881
Cell type: G/M prog, kNN trace: 1.0824175824175823
Cell type: G/M prog, EOT trace: 4.35411426353429
Cell type: G/M prog, kNN FOSCTTM: 0.4036409729998756
Cell type: G/M prog, EOT FOSCTTM: 0.40001258384517063
Cell type: HSC, Number of samples: 1703
Cell type: HSC, kNN trace: 2.0588235294117645
Cell type: HSC, EOT trace: 1.4581921474964135
Cell type: HSC, kNN FOSCTTM: 0.3960447209700446
Cell type: HSC, EOT FOSCTTM: 0.42291270054296937
Cell type: ILC, Number of samples: 238
Cell type: ILC, kNN trace: 1.75
Cell type: ILC, EOT trace: 1.7129379105311748
Cell type: ILC, kNN FOSCTTM: 0.5221341701237457
Cell type: ILC, EOT FOSCTTM: 0.5261585646916994
Cell type: ILC1, Number of samples: 552
Cell type: ILC1, kNN trace: 1.7091743119266054
Cell type: ILC1, EOT trace: 1.107233028980847
Cell type: ILC1, kNN FOSCTTM: 0.43088324258923166
Cell type: ILC1, EOT FOSCTTM: 0.4172617638549146
Cell type: Lymph prog, Number of samples: 1681
Cell type: Lymph prog, kNN trace: 1.7010669610007356
Cell type: Lymph prog, EOT trace: 1.9327017706625933
Cell type: Lymph prog, kNN FOSCTTM: 0.4363224483725673
Cell type: Lymph prog, EOT FOSCTTM: 0.4550715631285232
Cell type: MAIT, Number of samples: 756
Cell type: MAIT, kNN trace: 2.0
Cell type: MAIT, EOT trace: 1.7411166094917394
Cell type: MAIT, kNN FOSCTTM: 0.48025158554959885
Cell type: MAIT, EOT FOSCTTM: 0.4542328042328042
Cell type: MK/E prog, Number of samples: 690
Cell type: MK/E prog, kNN trace: 1.3583333333333332
Cell type: MK/E prog, EOT trace: 1.601642637065031
Cell type: MK/E prog, kNN FOSCTTM: 0.41315285753349734
Cell type: MK/E prog, EOT FOSCTTM: 0.42950505879135903
Cell type: NK, Number of samples: 5434
Cell type: NK, kNN trace: 1.0
Cell type: NK, EOT trace: 2.2198975468599667
Cell type: NK, kNN FOSCTTM: 0.4029931556232815
Cell type: NK, EOT FOSCTTM: 0.41216282724318415
Cell type: NK CD158e1+, Number of samples: 2167
Cell type: NK CD158e1+, kNN trace: 3.032258064516129
Cell type: NK CD158e1+, EOT trace: 1.0176804072606558
Cell type: NK CD158e1+, kNN FOSCTTM: 0.3919001807094668
Cell type: NK CD158e1+, EOT FOSCTTM: 0.4620717843962638
Cell type: Naive CD20+ B IGKC+, Number of samples: 3990
Cell type: Naive CD20+ B IGKC+, kNN trace: 1.0
Cell type: Naive CD20+ B IGKC+, EOT trace: 2.0495781035212595
Cell type: Naive CD20+ B IGKC+, kNN FOSCTTM: 0.4291000125030551
Cell type: Naive CD20+ B IGKC+, EOT FOSCTTM: 0.4709800635959414
Cell type: Naive CD20+ B IGKC-, Number of samples: 1979
Cell type: Naive CD20+ B IGKC-, kNN trace: 1.0
Cell type: Naive CD20+ B IGKC-, EOT trace: 1.682688589736069
Cell type: Naive CD20+ B IGKC-, kNN FOSCTTM: 0.410339786157076
Cell type: Naive CD20+ B IGKC-, EOT FOSCTTM: 0.4587611273273313
Cell type: Normoblast, Number of samples: 1435
Cell type: Normoblast, kNN trace: 3.000996015936255
Cell type: Normoblast, EOT trace: 1.2280494449760204
Cell type: Normoblast, kNN FOSCTTM: 0.3588420101176505
Cell type: Normoblast, EOT FOSCTTM: 0.3899447951443053
Cell type: Plasma cell IGKC+, Number of samples: 288
Cell type: Plasma cell IGKC+, kNN trace: 0.6428571428571428
Cell type: Plasma cell IGKC+, EOT trace: 2.8326634226270584
Cell type: Plasma cell IGKC+, kNN FOSCTTM: 0.37697807781649245
Cell type: Plasma cell IGKC+, EOT FOSCTTM: 0.42753097173828875
Cell type: Plasma cell IGKC-, Number of samples: 239
Cell type: Plasma cell IGKC-, kNN trace: 1.2674749848662892
Cell type: Plasma cell IGKC-, EOT trace: 2.0427206505265163
Cell type: Plasma cell IGKC-, kNN FOSCTTM: 0.4417741992194367
Cell type: Plasma cell IGKC-, EOT FOSCTTM: 0.4716254702717907
Cell type: Plasmablast IGKC+, Number of samples: 232
Cell type: Plasmablast IGKC+, kNN trace: 1.6351851851851853
Cell type: Plasmablast IGKC+, EOT trace: 3.5547807234664606
Cell type: Plasmablast IGKC+, kNN FOSCTTM: 0.4777018958053441
Cell type: Plasmablast IGKC+, EOT FOSCTTM: 0.47179616360650845
Cell type: Plasmablast IGKC-, Number of samples: 130
Cell type: Plasmablast IGKC-, kNN trace: 0.24707602339181284
Cell type: Plasmablast IGKC-, EOT trace: 0.7484550887861177
Cell type: Plasmablast IGKC-, kNN FOSCTTM: 0.4516994633273704
Cell type: Plasmablast IGKC-, EOT FOSCTTM: 0.44314251639833036
Cell type: Proerythroblast, Number of samples: 1512
Cell type: Proerythroblast, kNN trace: 3.0501316104331178
Cell type: Proerythroblast, EOT trace: 1.7357570394139712
Cell type: Proerythroblast, kNN FOSCTTM: 0.3936660258632462
Cell type: Proerythroblast, EOT FOSCTTM: 0.40651032638954543
Cell type: Reticulocyte, Number of samples: 4272
Cell type: Reticulocyte, kNN trace: 0.45
Cell type: Reticulocyte, EOT trace: 1.175710710541537
Cell type: Reticulocyte, kNN FOSCTTM: 0.32933157116587175
Cell type: Reticulocyte, EOT FOSCTTM: 0.4065251331381313
Cell type: T prog cycling, Number of samples: 24
Cell type: T prog cycling, kNN trace: 1.3958333333333333
Cell type: T prog cycling, EOT trace: 0.7574789946444545
Cell type: T prog cycling, kNN FOSCTTM: 0.3460144927536232
Cell type: T prog cycling, EOT FOSCTTM: 0.4429347826086956
Cell type: T reg, Number of samples: 609
Cell type: T reg, kNN trace: 3.25
Cell type: T reg, EOT trace: 1.7415244109730672
Cell type: T reg, kNN FOSCTTM: 0.4476533467288912
Cell type: T reg, EOT FOSCTTM: 0.4372245268343273
Cell type: Transitional B, Number of samples: 1575
Cell type: Transitional B, kNN trace: 1.0
Cell type: Transitional B, EOT trace: 0.5335199010684852
Cell type: Transitional B, kNN FOSCTTM: 0.41015610818660375
Cell type: Transitional B, EOT FOSCTTM: 0.5148780782961214
Cell type: cDC1, Number of samples: 18
Cell type: cDC1, kNN trace: 0.3214285714285714
Cell type: cDC1, EOT trace: 1.8572463619874433
Cell type: cDC1, kNN FOSCTTM: 0.5179738562091504
Cell type: cDC1, EOT FOSCTTM: 0.5326797385620916
Cell type: cDC2, Number of samples: 1702
Cell type: cDC2, kNN trace: 0.3333333333333333
Cell type: cDC2, EOT trace: 1.9622971205956676
Cell type: cDC2, kNN FOSCTTM: 0.47270458864661763
Cell type: cDC2, EOT FOSCTTM: 0.4756025867136979
Cell type: dnT, Number of samples: 56
Cell type: dnT, kNN trace: 1.3888888888888888
Cell type: dnT, EOT trace: 2.0829970825761537
Cell type: dnT, kNN FOSCTTM: 0.5196428571428572
Cell type: dnT, EOT FOSCTTM: 0.45909090909090905
Cell type: gdT CD158b+, Number of samples: 674
Cell type: gdT CD158b+, kNN trace: 2.0
Cell type: gdT CD158b+, EOT trace: 2.0756306946853442
Cell type: gdT CD158b+, kNN FOSCTTM: 0.4172049505954559
Cell type: gdT CD158b+, EOT FOSCTTM: 0.4476997455919506
Cell type: gdT TCRVD2+, Number of samples: 191
Cell type: gdT TCRVD2+, kNN trace: 0.8125
Cell type: gdT TCRVD2+, EOT trace: 2.7748057006026383
Cell type: gdT TCRVD2+, kNN FOSCTTM: 0.4606503168917057
Cell type: gdT TCRVD2+, EOT FOSCTTM: 0.47464866354367596
Cell type: pDC, Number of samples: 1758
Cell type: pDC, kNN trace: 0.3333333333333333
Cell type: pDC, EOT trace: 1.4720893805194177
Cell type: pDC, kNN FOSCTTM: 0.4575716312387375
Cell type: pDC, EOT FOSCTTM: 0.44717699978567765
Average kNN Trace 1.488762218857328
Average EOT Trace 2.011536324592586
Average kNN FOSCTTM 0.4179417991437567
Average EOT FOSCTTM 0.43570873958716505
wandb: Currently logged in as: xijohnny9 (ps-matching). Use `wandb login --relogin` to force relogin
wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: | Waiting for wandb.init()...wandb: / Waiting for wandb.init()...wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: | Waiting for wandb.init()...wandb: Tracking run with wandb version 0.15.12
wandb: Run data is saved locally in checkpoints/balls/wandb/run-20231024_093806-g7e6hrvs
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run rose-armadillo-45
wandb: ⭐️ View project at https://wandb.ai/ps-matching/lightning_logs
wandb: 🚀 View run at https://wandb.ai/ps-matching/lightning_logs/runs/g7e6hrvs
/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/torch/nn/modules/lazy.py:180: UserWarning: Lazy modules are a new feature under heavy development so changes to the API or functionality can happen at any moment.
  warnings.warn('Lazy modules are a new feature under heavy development '
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
You are using a CUDA device ('NVIDIA A100-SXM4-80GB') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
It.  |Err         
-------------------
    0|9.931944e-04|
   10|3.542410e-05|
   20|5.025887e-05|
   30|6.259868e-06|
   40|3.582024e-07|
   50|1.934518e-08|
   60|1.041385e-09|
   70|5.604974e-11|
scot took 4.908778712153435 seconds on label 0 with 595 samples
It.  |Err         
-------------------
    0|1.238355e-03|
   10|1.811400e-05|
   20|1.480278e-05|
   30|1.085499e-05|
   40|6.568187e-06|
   50|3.432717e-06|
   60|1.645400e-06|
   70|7.546992e-07|
   80|3.390359e-07|
   90|1.508715e-07|
  100|6.685418e-08|
  110|2.956873e-08|
  120|1.306697e-08|
  130|5.772405e-09|
  140|2.549577e-09|
  150|1.126026e-09|
  160|4.972956e-10|
scot took 4.376763617154211 seconds on label 1 with 440 samples
It.  |Err         
-------------------
    0|8.467151e-03|
   10|1.182922e-03|
   20|4.580931e-04|
   30|5.339307e-04|
   40|2.518339e-04|
   50|1.647704e-04|
   60|1.192061e-04|
   70|8.845545e-05|
   80|6.467791e-05|
   90|4.578220e-05|
  100|3.133471e-05|
  110|2.086148e-05|
  120|1.360976e-05|
  130|8.755484e-06|
  140|5.580489e-06|
  150|3.535410e-06|
  160|2.231128e-06|
  170|1.404556e-06|
  180|8.828288e-07|
  190|5.543542e-07|
It.  |Err         
-------------------
  200|3.478802e-07|
  210|2.182245e-07|
  220|1.368583e-07|
  230|8.581686e-08|
  240|5.380620e-08|
  250|3.373385e-08|
  260|2.114867e-08|
  270|1.325837e-08|
  280|8.311712e-09|
  290|5.210590e-09|
  300|3.266486e-09|
  310|2.047732e-09|
  320|1.283703e-09|
  330|8.047392e-10|
scot took 0.5329651099164039 seconds on label 2 with 93 samples
It.  |Err         
-------------------
    0|2.856945e-04|
   10|1.600818e-06|
   20|5.660460e-09|
   30|2.076233e-11|
scot took 37.89036784507334 seconds on label 3 with 2500 samples
It.  |Err         
-------------------
    0|9.872283e-04|
   10|4.036496e-05|
   20|1.305039e-06|
   30|3.566464e-08|
   40|9.785729e-10|
scot took 4.000236767111346 seconds on label 4 with 825 samples
It.  |Err         
-------------------
    0|2.289358e-04|
   10|9.155381e-06|
   20|4.527858e-07|
   30|6.853790e-08|
   40|1.040466e-08|
   50|1.578269e-09|
   60|2.393896e-10|
scot took 59.19131124415435 seconds on label 5 with 2500 samples
It.  |Err         
-------------------
    0|6.426680e-04|
   10|3.303091e-05|
   20|5.047085e-06|
   30|7.787782e-07|
   40|1.265731e-07|
   50|2.068074e-08|
   60|3.368323e-09|
   70|5.471408e-10|
scot took 3.2178125588689 seconds on label 6 with 662 samples
It.  |Err         
-------------------
    0|6.666300e-04|
   10|1.464517e-06|
   20|2.596615e-08|
   30|4.647738e-10|
scot took 3.5807129631284624 seconds on label 7 with 943 samples
It.  |Err         
-------------------
    0|1.192752e-03|
   10|6.536677e-06|
   20|1.853464e-07|
   30|6.605922e-09|
   40|2.669467e-10|
scot took 1.246468264842406 seconds on label 8 with 428 samples
It.  |Err         
-------------------
    0|1.056870e-03|
   10|2.535526e-07|
   20|1.593059e-11|
scot took 0.8216920988634229 seconds on label 9 with 507 samples
It.  |Err         
-------------------
    0|1.304544e-03|
   10|6.667941e-05|
   20|2.541430e-05|
   30|2.232694e-06|
   40|1.553379e-07|
   50|1.063706e-08|
   60|7.278106e-10|
scot took 2.0830020250286907 seconds on label 10 with 541 samples
It.  |Err         
-------------------
    0|1.013917e-03|
   10|3.171361e-06|
   20|1.679508e-09|
   30|8.786067e-13|
scot took 3.341756593901664 seconds on label 11 with 861 samples
It.  |Err         
-------------------
    0|1.033170e-03|
   10|2.270472e-06|
   20|5.844146e-10|
scot took 3.658892507199198 seconds on label 12 with 971 samples
It.  |Err         
-------------------
    0|4.214253e-04|
   10|3.498929e-07|
   20|6.673683e-09|
   30|1.628186e-10|
scot took 40.85584084200673 seconds on label 13 with 2319 samples
It.  |Err         
-------------------
    0|2.100230e-02|
   10|4.261292e-03|
   20|5.931002e-03|
   30|2.492345e-03|
   40|1.066580e-03|
   50|3.241069e-04|
   60|1.219806e-04|
   70|4.478092e-05|
   80|1.617948e-05|
   90|5.810468e-06|
  100|2.082051e-06|
  110|7.454518e-07|
  120|2.668211e-07|
  130|9.549373e-08|
  140|3.417535e-08|
  150|1.223053e-08|
  160|4.376985e-09|
  170|1.566406e-09|
  180|5.605744e-10|
scot took 1.692000841954723 seconds on label 14 with 42 samples
It.  |Err         
-------------------
    0|2.839010e-04|
   10|4.880934e-05|
   20|8.875231e-06|
   30|2.915420e-07|
   40|1.291224e-08|
   50|6.695595e-10|
scot took 71.74066209304146 seconds on label 15 with 2500 samples
It.  |Err         
-------------------
    0|3.513425e-04|
   10|1.718466e-05|
   20|1.079618e-06|
   30|7.556807e-08|
   40|5.314814e-09|
   50|3.739257e-10|
scot took 52.72816815203987 seconds on label 16 with 2332 samples
It.  |Err         
-------------------
    0|2.953514e-04|
   10|2.578855e-05|
   20|3.831316e-06|
   30|3.485209e-07|
   40|3.060344e-08|
   50|2.677814e-09|
   60|2.342296e-10|
scot took 52.44980758195743 seconds on label 17 with 2500 samples
It.  |Err         
-------------------
    0|5.624489e-04|
   10|3.159416e-05|
   20|1.836179e-06|
   30|8.808821e-08|
   40|4.184416e-09|
   50|1.986774e-10|
scot took 17.184021166991442 seconds on label 18 with 1482 samples
It.  |Err         
-------------------
    0|6.524992e-04|
   10|8.450450e-07|
   20|1.752232e-10|
scot took 6.521263218019158 seconds on label 19 with 1302 samples
It.  |Err         
-------------------
    0|6.146089e-03|
   10|6.271379e-05|
   20|6.609203e-06|
   30|6.758259e-07|
   40|6.894110e-08|
   50|7.033143e-09|
   60|7.175555e-10|
scot took 1.1350665248464793 seconds on label 20 with 135 samples
It.  |Err         
-------------------
    0|1.091269e-03|
   10|2.564452e-05|
   20|3.603922e-05|
   30|2.576456e-05|
   40|8.640003e-06|
   50|2.047660e-06|
   60|4.419378e-07|
   70|9.340994e-08|
   80|1.965593e-08|
   90|4.132254e-09|
  100|8.685501e-10|
scot took 2.143424255074933 seconds on label 21 with 403 samples
It.  |Err         
-------------------
    0|6.759475e-04|
   10|1.057416e-04|
   20|4.490482e-05|
   30|6.018929e-06|
   40|1.215456e-06|
   50|2.574256e-07|
   60|5.474495e-08|
   70|1.164988e-08|
   80|2.479452e-09|
   90|5.277176e-10|
scot took 10.476013752864674 seconds on label 22 with 1002 samples
It.  |Err         
-------------------
    0|1.295179e-03|
   10|5.363239e-06|
   20|9.478803e-08|
   30|1.867549e-09|
   40|3.647290e-11|
scot took 1.3177777829114348 seconds on label 23 with 480 samples
It.  |Err         
-------------------
    0|1.687577e-03|
   10|1.022855e-06|
   20|3.123684e-08|
   30|9.875480e-10|
scot took 1.3302439581602812 seconds on label 24 with 490 samples
It.  |Err         
-------------------
    0|3.021293e-04|
   10|8.289717e-06|
   20|1.427902e-07|
   30|4.521154e-09|
   40|1.543561e-10|
scot took 45.360968871973455 seconds on label 25 with 2500 samples
It.  |Err         
-------------------
    0|4.072707e-04|
   10|7.193132e-08|
   20|3.652217e-11|
scot took 16.08764522196725 seconds on label 26 with 1861 samples
It.  |Err         
-------------------
    0|3.814234e-04|
   10|3.547072e-06|
   20|4.531581e-08|
   30|5.581738e-10|
scot took 43.545941981021315 seconds on label 27 with 2500 samples
It.  |Err         
-------------------
    0|6.977595e-04|
   10|1.471280e-05|
   20|2.961496e-06|
   30|3.736103e-07|
   40|4.409927e-08|
   50|5.162198e-09|
   60|6.036287e-10|
scot took 12.394329921109602 seconds on label 28 with 1329 samples
It.  |Err         
-------------------
    0|5.019847e-04|
   10|1.936558e-05|
   20|1.526125e-07|
   30|1.269515e-09|
   40|1.056484e-11|
scot took 9.629214002052322 seconds on label 29 with 1285 samples
It.  |Err         
-------------------
    0|3.423403e-03|
   10|2.240467e-04|
   20|6.050495e-06|
   30|2.669672e-07|
   40|1.262869e-08|
   50|5.996505e-10|
scot took 1.4186339031439275 seconds on label 30 with 244 samples
It.  |Err         
-------------------
    0|3.746718e-03|
   10|2.939536e-04|
   20|4.138858e-06|
   30|7.978264e-08|
   40|1.546455e-09|
   50|3.000572e-11|
scot took 1.3003226581495255 seconds on label 31 with 207 samples
It.  |Err         
-------------------
    0|3.776549e-03|
   10|6.431018e-05|
   20|1.300395e-07|
   30|2.463702e-10|
/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/ot/bregman.py:536: UserWarning: Sinkhorn did not converge. You might want to increase the number of iterations `numItermax` or the regularization parameter `reg`.
  warnings.warn("Sinkhorn did not converge. You might want to "
/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/ot/bregman.py:536: UserWarning: Sinkhorn did not converge. You might want to increase the number of iterations `numItermax` or the regularization parameter `reg`.
  warnings.warn("Sinkhorn did not converge. You might want to "
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/utilities/model_summary/model_summary.py:452: A layer with UninitializedParameter was found. Thus, the total number of parameters detected may be inaccurate.

  | Name | Type             | Params
------------------------------------------
0 | loss | CrossEntropyLoss | 0     
1 | clf1 | Sequential       | 0     
2 | clf2 | Sequential       | 0     
------------------------------------------
0         Trainable params
0         Non-trainable params
0         Total params
0.000     Total estimated model params size (MB)
SLURM auto-requeueing enabled. Setting signal handlers.
scot took 1.0650399480946362 seconds on label 32 with 212 samples
It.  |Err         
-------------------
    0|5.385058e-03|
   10|8.073020e-05|
   20|9.179430e-05|
   30|8.702942e-05|
   40|5.576253e-05|
   50|2.533735e-05|
   60|9.546072e-06|
   70|3.330408e-06|
   80|1.130118e-06|
   90|3.798508e-07|
  100|1.272641e-07|
  110|4.259225e-08|
  120|1.424946e-08|
  130|4.766654e-09|
  140|1.594452e-09|
  150|5.333388e-10|
scot took 9.168376615038142 seconds on label 33 with 109 samples
It.  |Err         
-------------------
    0|1.101386e-03|
   10|1.569524e-05|
   20|4.194919e-07|
   30|1.131923e-08|
   40|3.054526e-10|
scot took 4.633561098948121 seconds on label 34 with 874 samples
It.  |Err         
-------------------
    0|3.686529e-04|
   10|3.150381e-05|
   20|2.209901e-07|
   30|1.567510e-09|
   40|1.119234e-11|
scot took 41.10119525808841 seconds on label 35 with 2500 samples
It.  |Err         
-------------------
    0|3.757204e-02|
   10|3.099894e-03|
   20|1.706697e-03|
   30|2.382393e-04|
   40|1.675386e-05|
   50|1.103466e-06|
   60|7.206413e-08|
   70|4.691701e-09|
   80|3.050334e-10|
scot took 0.7620947039686143 seconds on label 36 with 23 samples
It.  |Err         
-------------------
    0|1.284880e-03|
   10|5.910539e-05|
   20|8.467164e-06|
   30|9.259259e-07|
   40|1.000205e-07|
   50|1.080072e-08|
   60|1.166376e-09|
   70|1.259594e-10|
scot took 1.245645219925791 seconds on label 37 with 428 samples
It.  |Err         
-------------------
    0|8.543879e-04|
   10|1.432303e-04|
   20|3.223325e-06|
   30|7.801815e-10|
scot took 3.401385995093733 seconds on label 38 with 1003 samples
It.  |Err         
-------------------
    0|7.166095e-02|
   10|5.855817e-03|
   20|5.950947e-04|
   30|1.997609e-05|
   40|6.620800e-07|
   50|9.080813e-07|
   60|1.429803e-04|
   70|5.487753e-03|
   80|2.028395e-02|
   90|8.396601e-06|
  100|2.850450e-07|
  110|9.794798e-09|
  120|3.365971e-10|
scot took 3.374662200920284 seconds on label 39 with 16 samples
It.  |Err         
-------------------
    0|4.545069e-04|
   10|1.724707e-04|
   20|1.218205e-05|
   30|4.283940e-07|
   40|1.570781e-08|
   50|5.768691e-10|
scot took 12.931582792196423 seconds on label 40 with 1463 samples
It.  |Err         
-------------------
    0|1.481849e-02|
   10|4.300554e-04|
   20|4.583118e-06|
   30|5.324887e-08|
   40|6.176886e-10|
scot took 0.5953343419823796 seconds on label 41 with 56 samples
It.  |Err         
-------------------
    0|1.968635e-03|
   10|2.075751e-04|
   20|1.672110e-05|
   30|1.196526e-06|
   40|1.217794e-07|
   50|1.473453e-08|
   60|1.863914e-09|
   70|2.379177e-10|
scot took 0.8790422340389341 seconds on label 42 with 239 samples
It.  |Err         
-------------------
    0|4.609218e-03|
   10|3.561373e-04|
   20|6.286696e-05|
   30|2.872363e-05|
   40|9.077343e-06|
   50|2.440821e-06|
   60|6.269300e-07|
   70|1.591673e-07|
   80|4.029797e-08|
   90|1.019655e-08|
  100|2.579793e-09|
  110|6.527140e-10|
scot took 1.5594132458791137 seconds on label 43 with 171 samples
It.  |Err         
-------------------
    0|5.193310e-04|
   10|9.658920e-06|
   20|1.540698e-08|
   30|3.066038e-11|
scot took 13.03395632095635 seconds on label 44 with 1615 samples
/rxrx/scratch/sandbox/johnny.xi/matching/matching/data_utils/datamodules.py:22: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  self._groups = self.metadata.groupby("batch")
Traceback (most recent call last):
  File "/rxrx/scratch/sandbox/johnny.xi/matching/main.py", line 41, in <module>
    trainer.fit(model = model, datamodule = data)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 545, in fit
    call._call_and_handle_interrupt(
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 581, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 990, in _run
    results = self._run_stage()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1034, in _run_stage
    self._run_sanity_check()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1063, in _run_sanity_check
    val_loop.run()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py", line 181, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 134, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 391, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/strategies/strategy.py", line 403, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/rxrx/scratch/sandbox/johnny.xi/matching/matching/models/base.py", line 47, in validation_step
    loss_dict = self.training_step(batch, batch_idx)
  File "/rxrx/scratch/sandbox/johnny.xi/matching/matching/models/base.py", line 39, in training_step
    self.train_match_x1[label] = np.concatenate((self.train_match_x1[label], logits_1[y == label].cpu().detach().numpy()))
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1614, in __getattr__
    raise AttributeError("'{}' object has no attribute '{}'".format(
AttributeError: 'GEXADT_Classifier' object has no attribute 'train_match_x1'
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: - 0.027 MB of 0.027 MB uploaded (0.000 MB deduped)wandb: \ 0.027 MB of 0.027 MB uploaded (0.000 MB deduped)wandb: | 0.027 MB of 0.027 MB uploaded (0.000 MB deduped)wandb: / 0.027 MB of 0.027 MB uploaded (0.000 MB deduped)wandb: - 0.027 MB of 0.027 MB uploaded (0.000 MB deduped)wandb: 
wandb: Run summary:
wandb:       SCOT FOSCTTM 0 0.417
wandb:       SCOT FOSCTTM 1 0.36941
wandb:      SCOT FOSCTTM 10 0.31878
wandb:      SCOT FOSCTTM 11 0.46169
wandb:      SCOT FOSCTTM 12 0.46611
wandb:      SCOT FOSCTTM 13 0.32877
wandb:      SCOT FOSCTTM 14 0.52933
wandb:      SCOT FOSCTTM 15 0.54477
wandb:      SCOT FOSCTTM 16 0.48335
wandb:      SCOT FOSCTTM 17 0.43457
wandb:      SCOT FOSCTTM 18 0.40005
wandb:      SCOT FOSCTTM 19 0.5146
wandb:       SCOT FOSCTTM 2 0.4138
wandb:      SCOT FOSCTTM 20 0.3296
wandb:      SCOT FOSCTTM 21 0.57958
wandb:      SCOT FOSCTTM 22 0.51645
wandb:      SCOT FOSCTTM 23 0.32209
wandb:      SCOT FOSCTTM 24 0.53366
wandb:      SCOT FOSCTTM 25 0.45779
wandb:      SCOT FOSCTTM 26 0.50253
wandb:      SCOT FOSCTTM 27 0.42586
wandb:      SCOT FOSCTTM 28 0.35122
wandb:      SCOT FOSCTTM 29 0.41848
wandb:       SCOT FOSCTTM 3 0.60926
wandb:      SCOT FOSCTTM 30 0.51359
wandb:      SCOT FOSCTTM 31 0.37219
wandb:      SCOT FOSCTTM 32 0.31737
wandb:      SCOT FOSCTTM 33 0.6205
wandb:      SCOT FOSCTTM 34 0.55021
wandb:      SCOT FOSCTTM 35 0.47493
wandb:      SCOT FOSCTTM 36 0.51087
wandb:      SCOT FOSCTTM 37 0.59646
wandb:      SCOT FOSCTTM 38 0.53154
wandb:      SCOT FOSCTTM 39 0.62292
wandb:       SCOT FOSCTTM 4 0.3585
wandb:      SCOT FOSCTTM 40 0.46284
wandb:      SCOT FOSCTTM 41 0.225
wandb:      SCOT FOSCTTM 42 0.62042
wandb:      SCOT FOSCTTM 43 0.57693
wandb:      SCOT FOSCTTM 44 0.49017
wandb:       SCOT FOSCTTM 5 0.27382
wandb:       SCOT FOSCTTM 6 0.55386
wandb:       SCOT FOSCTTM 7 0.37411
wandb:       SCOT FOSCTTM 8 0.5895
wandb:       SCOT FOSCTTM 9 0.38429
wandb: SCOT FOSCTTM Average 0.46108
wandb:         SCOT Trace 0 1.29732
wandb:         SCOT Trace 1 1.53051
wandb:        SCOT Trace 10 1.92594
wandb:        SCOT Trace 11 1.32417
wandb:        SCOT Trace 12 1.16771
wandb:        SCOT Trace 13 1.82202
wandb:        SCOT Trace 14 1.32738
wandb:        SCOT Trace 15 1.38673
wandb:        SCOT Trace 16 1.38117
wandb:        SCOT Trace 17 1.95915
wandb:        SCOT Trace 18 1.40271
wandb:        SCOT Trace 19 0.9686
wandb:         SCOT Trace 2 1.49507
wandb:        SCOT Trace 20 2.05396
wandb:        SCOT Trace 21 0.66826
wandb:        SCOT Trace 22 0.88473
wandb:        SCOT Trace 23 1.76155
wandb:        SCOT Trace 24 0.83853
wandb:        SCOT Trace 25 1.1946
wandb:        SCOT Trace 26 1.02451
wandb:        SCOT Trace 27 1.21519
wandb:        SCOT Trace 28 2.05968
wandb:        SCOT Trace 29 1.48826
wandb:         SCOT Trace 3 0.50584
wandb:        SCOT Trace 30 0.64879
wandb:        SCOT Trace 31 1.42069
wandb:        SCOT Trace 32 1.31344
wandb:        SCOT Trace 33 0.97541
wandb:        SCOT Trace 34 0.71027
wandb:        SCOT Trace 35 1.15819
wandb:        SCOT Trace 36 0.58429
wandb:        SCOT Trace 37 0.70524
wandb:        SCOT Trace 38 0.81896
wandb:        SCOT Trace 39 0.94712
wandb:         SCOT Trace 4 1.75599
wandb:        SCOT Trace 40 1.1158
wandb:        SCOT Trace 41 3.5616
wandb:        SCOT Trace 42 0.39084
wandb:        SCOT Trace 43 0.60784
wandb:        SCOT Trace 44 1.15427
wandb:         SCOT Trace 5 2.31036
wandb:         SCOT Trace 6 0.78579
wandb:         SCOT Trace 7 1.62456
wandb:         SCOT Trace 8 0.74559
wandb:         SCOT Trace 9 1.46622
wandb:   SCOT Trace Average 1.27744
wandb: 
wandb: 🚀 View run rose-armadillo-45 at: https://wandb.ai/ps-matching/lightning_logs/runs/g7e6hrvs
wandb: ️⚡ View job at https://wandb.ai/ps-matching/lightning_logs/jobs/QXJ0aWZhY3RDb2xsZWN0aW9uOjEwODQ0OTkzNQ==/version_details/v16
wandb: Synced 5 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: checkpoints/balls/wandb/run-20231024_093806-g7e6hrvs/logs
Sanity Checking: |          | 0/? [00:00<?, ?it/s]Sanity Checking:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]srun: error: dgx8: task 0: Exited with exit code 1
wandb: Currently logged in as: xijohnny9 (ps-matching). Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.15.12
wandb: Run data is saved locally in checkpoints/balls/wandb/run-20231024_095121-imoaou5g
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run volcanic-grass-49
wandb: ⭐️ View project at https://wandb.ai/ps-matching/lightning_logs
wandb: 🚀 View run at https://wandb.ai/ps-matching/lightning_logs/runs/imoaou5g
/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet18_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet18_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
You are using a CUDA device ('NVIDIA A100-SXM4-80GB') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name      | Type             | Params
-----------------------------------------------
0 | loss      | CrossEntropyLoss | 0     
1 | Encoder_1 | ImageEncoder     | 11.9 M
2 | logits_1  | Sequential       | 1.5 K 
3 | Encoder_2 | ImageEncoder     | 11.9 M
4 | logits_2  | Sequential       | 1.5 K 
5 | clf1      | Sequential       | 11.9 M
6 | clf2      | Sequential       | 11.9 M
-----------------------------------------------
23.7 M    Trainable params
0         Non-trainable params
23.7 M    Total params
94.842    Total estimated model params size (MB)
SLURM auto-requeueing enabled. Setting signal handlers.
It.  |Err         
-------------------
    0|4.922630e-04|
   10|1.035656e-05|
   20|9.180784e-07|
   30|8.969451e-08|
   40|8.864853e-09|
   50|8.771259e-10|
scot took 97.80316593893804 seconds on label 0 with 1651 samples
It.  |Err         
-------------------
    0|6.792320e-04|
   10|2.478952e-07|
   20|2.974882e-09|
   30|6.475643e-11|
scot took 154.73613945185207 seconds on label 1 with 1704 samples
It.  |Err         
-------------------
    0|4.050752e-04|
   10|2.391170e-07|
   20|3.493454e-09|
   30|5.616679e-11|
scot took 133.8409107539337 seconds on label 2 with 1717 samples
It.  |Err         
-------------------
    0|4.540498e-04|
   10|6.466202e-05|
   20|1.226450e-05|
   30|1.190147e-05|
   40|1.508241e-05|
   50|1.118263e-05|
   60|5.743727e-06|
   70|2.654395e-06|
   80|1.206389e-06|
   90|5.454166e-07|
  100|2.457941e-07|
  110|1.105504e-07|
  120|4.966526e-08|
  130|2.229789e-08|
  140|1.000727e-08|
  150|4.490325e-09|
  160|2.014598e-09|
  170|9.037936e-10|
scot took 127.52739570010453 seconds on label 3 with 1647 samples
It.  |Err         
-------------------
    0|3.546939e-04|
   10|8.636093e-05|
   20|8.584376e-06|
   30|4.025736e-06|
   40|3.229673e-06|
   50|2.296231e-06|
   60|1.451662e-06|
   70|8.470290e-07|
   80|4.709038e-07|
   90|2.547516e-07|
  100|1.357839e-07|
  110|7.180088e-08|
  120|3.780802e-08|
  130|1.986440e-08|
  140|1.042463e-08|
  150|5.467397e-09|
  160|2.866560e-09|
  170|1.502686e-09|
  180|7.876576e-10|
scot took 156.11622073501348 seconds on label 4 with 1696 samples
It.  |Err         
-------------------
    0|4.197965e-04|
   10|8.605649e-07|
   20|2.316685e-08|
   30|6.246480e-10|
scot took 96.96574723511003 seconds on label 5 with 1595 samples
It.  |Err         
-------------------
    0|1.568849e-04|
   10|1.479133e-07|
   20|5.468281e-10|
scot took 85.00785137200728 seconds on label 6 with 1611 samples
It.  |Err         
-------------------
    0|2.382171e-04|
   10|2.243225e-08|
   20|6.898302e-11|
scot took 94.15080146701075 seconds on label 7 with 1670 samples
It.  |Err         
-------------------
    0|3.461681e-04|
   10|2.766554e-08|
   20|1.093846e-11|
scot took 100.79423532402143 seconds on label 8 with 1665 samples
It.  |Err         
-------------------
    0|1.076171e-04|
   10|1.269061e-06|
   20|1.670714e-10|
scot took 103.72407375299372 seconds on label 9 with 1784 samples
It.  |Err         
-------------------
    0|1.125144e-04|
   10|9.657979e-06|
   20|1.221287e-08|
   30|7.396729e-11|
scot took 91.19381050718948 seconds on label 10 with 1630 samples
It.  |Err         
-------------------
    0|1.029222e-04|
   10|2.269094e-06|
   20|5.047856e-05|
   30|6.035148e-06|
   40|2.194979e-06|
   50|6.995252e-07|
   60|2.095546e-07|
   70|6.158233e-08|
   80|1.799507e-08|
   90|5.249667e-09|
  100|1.530736e-09|
  110|4.462800e-10|
scot took 102.99861822789535 seconds on label 11 with 1630 samples
Traceback (most recent call last):
  File "/rxrx/scratch/sandbox/johnny.xi/matching/main.py", line 41, in <module>
    trainer.fit(model = model, datamodule = data)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 545, in fit
    call._call_and_handle_interrupt(
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 581, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 990, in _run
    results = self._run_stage()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1034, in _run_stage
    self._run_sanity_check()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1063, in _run_sanity_check
    val_loop.run()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py", line 181, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 134, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 391, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/pytorch_lightning/strategies/strategy.py", line 403, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
  File "/rxrx/scratch/sandbox/johnny.xi/matching/matching/models/base.py", line 47, in validation_step
  File "/rxrx/scratch/sandbox/johnny.xi/matching/matching/models/classifier.py", line 47, in training_step
    loss_dict = super().training_step(batch = (x1, x2, y), batch_idx = batch_idx)
  File "/rxrx/scratch/sandbox/johnny.xi/matching/matching/models/base.py", line 39, in training_step
    "md1_loss": loss_1,
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1614, in __getattr__
    raise AttributeError("'{}' object has no attribute '{}'".format(
AttributeError: 'BallsClassifier' object has no attribute 'train_match_x1'
wandb: Waiting for W&B process to finish... (failed 1). Press Control-C to abort syncing.
wandb: 
wandb: Run summary:
wandb:       SCOT FOSCTTM 0 0.474
wandb:       SCOT FOSCTTM 1 0.29618
wandb:      SCOT FOSCTTM 10 0.23443
wandb:      SCOT FOSCTTM 11 0.57162
wandb:       SCOT FOSCTTM 2 0.67875
wandb:       SCOT FOSCTTM 3 0.48669
wandb:       SCOT FOSCTTM 4 0.57627
wandb:       SCOT FOSCTTM 5 0.64228
wandb:       SCOT FOSCTTM 6 0.2569
wandb:       SCOT FOSCTTM 7 0.21699
wandb:       SCOT FOSCTTM 8 0.26693
wandb:       SCOT FOSCTTM 9 0.24099
wandb: SCOT FOSCTTM Average 0.41184
wandb:           SCOT MSE 0 0.02462
wandb:           SCOT MSE 1 0.01385
wandb:          SCOT MSE 10 0.02321
wandb:          SCOT MSE 11 0.04939
wandb:           SCOT MSE 2 0.12726
wandb:           SCOT MSE 3 0.02659
wandb:           SCOT MSE 4 0.05392
wandb:           SCOT MSE 5 0.1228
wandb:           SCOT MSE 6 0.02278
wandb:           SCOT MSE 7 0.02185
wandb:           SCOT MSE 8 0.02214
wandb:           SCOT MSE 9 0.02278
wandb:     SCOT MSE Average 0.04427
wandb:         SCOT Trace 0 1.71583
wandb:         SCOT Trace 1 3.16359
wandb:        SCOT Trace 10 2.03942
wandb:        SCOT Trace 11 0.69113
wandb:         SCOT Trace 2 0.4371
wandb:         SCOT Trace 3 0.99584
wandb:         SCOT Trace 4 0.46351
wandb:         SCOT Trace 5 0.48606
wandb:         SCOT Trace 6 2.27531
wandb:         SCOT Trace 7 2.72749
wandb:         SCOT Trace 8 3.09825
wandb:         SCOT Trace 9 2.10767
wandb:   SCOT Trace Average 1.68343
wandb: 
wandb: 🚀 View run volcanic-grass-49 at: https://wandb.ai/ps-matching/lightning_logs/runs/imoaou5g
wandb: ️⚡ View job at https://wandb.ai/ps-matching/lightning_logs/jobs/QXJ0aWZhY3RDb2xsZWN0aW9uOjEwODQ0OTkzNQ==/version_details/v18
wandb: Synced 5 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: checkpoints/balls/wandb/run-20231024_095121-imoaou5g/logs
Exception in thread NetStatThr:
Traceback (most recent call last):
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/3.9.7/lib/python3.9/threading.py", line 973, in _bootstrap_inner
    self.run()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/3.9.7/lib/python3.9/threading.py", line 910, in run
    self._target(*self._args, **self._kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 267, in check_network_status
    self._loop_check_status(
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 223, in _loop_check_status
    local_handle = request()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface.py", line 735, in deliver_network_status
    return self._deliver_network_status(status)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 475, in _deliver_network_status
    return self._deliver_record(record)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 428, in _deliver_record
    handle = mailbox._deliver_record(record, interface=self)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/mailbox.py", line 455, in _deliver_record
    interface._publish(record)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface_sock.py", line 51, in _publish
    self._sock_client.send_record_publish(record)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 221, in send_record_publish
    self.send_server_request(server_req)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 155, in send_server_request
    self._send_message(msg)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 152, in _send_message
    self._sendall_with_error_handle(header + data)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 130, in _sendall_with_error_handle
    sent = self._sock.send(data)
BrokenPipeError: [Errno 32] Broken pipe
Exception in thread ChkStopThr:
Traceback (most recent call last):
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/3.9.7/lib/python3.9/threading.py", line 973, in _bootstrap_inner
    self.run()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/3.9.7/lib/python3.9/threading.py", line 910, in run
    self._target(*self._args, **self._kwargs)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 285, in check_stop_status
    self._loop_check_status(
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 223, in _loop_check_status
    local_handle = request()
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface.py", line 727, in deliver_stop_status
    return self._deliver_stop_status(status)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 459, in _deliver_stop_status
    return self._deliver_record(record)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 428, in _deliver_record
    handle = mailbox._deliver_record(record, interface=self)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/mailbox.py", line 455, in _deliver_record
    interface._publish(record)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/interface/interface_sock.py", line 51, in _publish
    self._sock_client.send_record_publish(record)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 221, in send_record_publish
    self.send_server_request(server_req)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 155, in send_server_request
    self._send_message(msg)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 152, in _send_message
    self._sendall_with_error_handle(header + data)
  File "/mnt/ps/home/CORP/johnny.xi/.pyenv/versions/matching/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 130, in _sendall_with_error_handle
    sent = self._sock.send(data)
BrokenPipeError: [Errno 32] Broken pipe
Sanity Checking: |          | 0/? [00:00<?, ?it/s]Sanity Checking:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]srun: error: dgx8: task 0: Exited with exit code 1
